<html>
<head>
<title>Glue Internals</title>
</head>
<body>
  <h1>Glue: Internals</h1>
  <h2>Front-End</h2>
<p>Glue is an iPhone application built for iOS 5.1 (the latest version of the SDK as of this writing) using Xcode 4.3.2 on a machine running Mac OSX Version 10.7.3.The source code for Glue was written in Objective-C and was compiled using Xcode's built-in compiler, Apple LLVM compiler 3.1. </p>
<p>There are two important things to keep in mind about Glue's particular development environment. First, the source code makes use of Xcode's ARC functionality (automatic reference counting). ARC saves us the trouble of having to do any sort of memory management, which used to be a common source of frustration and bugs in iOS development. </p>
<p>Second, the source code also makes use of Storyboards. Storyboards lets us drag and drop user interface objects onto a canvas and to define segues between different views/screens. Storyboards greatly simplify the task of creating the graphical user interface, which in the past used to be done mostly programatically.</p>
<p>Some experienced iOS programmers still develop iOS apps with ARC and Storyboards turned off, which changes the nature of the source code substantially. It is important to know what these differences are if you are one of those programmers.</p>
<p>Glue's iOS source code consists of 35 files, all of which are included in the "Glue" subdirectory of the Xcode project. The file "MainStoryboard.storyboard" outlines the connections between different views and defines the graphical user interface for most of the app. However, it is important to keep in mind that there are some GUI elements that cannot be defined using Storyboards such as adding a "Delete Event" at the bottom of a dynamically-sized table (see EventDetailViewController.m for an example).</p>
<p>Every view in Glue is a customized Objective-C class with its own .h file and .m file. The .h file is the public interface that shows the properties (i.e. instance variables) and the public classes that the class can be called with. The .m file is the Objective-C implementation of the public methods as well as some private helper methods. Each view needs to be its own class so that we can customize their behavior in our app.</p>
<p>For example, when you click on the app's fourth tab ("Friends"), the view that comes up is a subclass of UITableViewController called FriendsTableViewController. If you want to know which view is controlled by which class, simply click on a view in the Storyboard and pull up the "Indentity Inspector" in Xcode to see what class it corresponds to. Glue also has classes that do not correspond to any one object or view in the GUI but that represent data that we to encapsulate (e.g. the User and Event class).</p>
<p>Understanding how communication between objects works is also important for maintaining and developing Glue. To access information about the user that is currently logged in (e.g. name, e-mail) in any given view object, Glue uses a Singleton class called SingletonUser to represent the current user. In addition, if we want to pass certain information from one view to another, we usually do this via the method prepreForSegue. For instance, when a user taps on a Friend's name in the "Friends" tab, FriendsTableViewController sends the corresponding friend's details to FriendDetailViewController by calling the prepareForSegue method so that FriendsDetailViewController can display it. </p>
<p>Another way objects communicate with each other in Glue is through delegation, a fundamental concept in iOS development. To see an example of delegation, refer to the class InviteFriendCell. InviteFriendCell creates a delegation protocol that gets implemented by AddFriendsViewController.</p>
<p>Finally, most of the interaction with the back-end server is done through the SingletonUser class. The only server call that is done outside this class is createUser, which can be found in SignUpViewController. This is because a new user has to be created in the server before a SingletonClass object can be instantiated.</p>
  <h2>Back-End</h2>
  <p>Glue is hosted on an Amazon EC2 instance running Red Hat EL6 that can be accessed by sshing in with the command ssh root@glue-app.info -i key.pem, assuming that you've been issued the root user's key and it is in the working directory. The back-end is currently running on Apache 2.2.15 as configured in the last Virtual Host in /etc/httpd/conf/httpd.conf using an adapter located at /var/www/glue/adapter.wsgi.</p>
<p>Apache looks in /var/www/glue for all relevant files. The back-end code is located at /var/www/glue/glue.py and all data is stored in three json flat files: /var/www/glue/events.json, /var/www/glue/users.json, and /var/www/glue/auth.json. /var/www/glue/API documents all the public methods available to clients, the parameters they take, what they return, and what side-effects they have on the server state.</p>
<p>The server-side code is written in Python using the Bottle microframework, which essentially allows us to write functions to handle every supported request by attaching functions to routes. We also use Bottle to access GET parameters. For documentation and instructions on how to install Bottle, check <a href="http://bottlepy.org/docs/dev/tutorial.html">this</a> out.</p>
<p>Since all data is stored in flat files as json objects, the "database" is quite literally a dictionary of id to object mappings, so any user can be accessed by users[userid] where users = json.loads(open('users.json', 'r').read()). Helper functions for _like(a, b) and _starts_with(a, b) exist if you ever need to perform SQL-like queries as in the search_users method.</p>
<p>[<a href="API2.html">API documentation</a>]</p>
</body>
</html>
